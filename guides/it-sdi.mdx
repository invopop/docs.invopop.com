---
title: "Italy - SDI"
description: Issue and receive invoices in Italy
---

## Introduction

Invopop's SDI Italy provider allows users to generate, issue, and receive FatturaPA documents in Italy.

## Prerequisites

To issue invoices, the following details are required:

- Supplier details:
  - Company name and address
  - Italian tax ID (Partita IVA)
- For B2B sales, customer details including:
  - Italian tax ID (Partita IVA)
- Invoice line items with:
  - Price
  - VAT rates

To receive invoices, these items are necessary:
- Company details:
  - Italian tax ID (Partita IVA)
- A registered Recipient Code (Codice Destinatario) with the Italian tax authority

## Setup

Follow these steps to configure an Invopop Workspace for SDI invoicing:

<Steps>
<Step title="Connect the SDI Italy app">

1. Navigate to **Configuration** > **Apps**.
2. Locate **SDI Italy** in the app discovery list.
3. Click **Connect** to activate.

No additional configuration is needed.

</Step>

<Step title="Configure invoice workflows">

First, review our [workflows guide](/guides/workflows) to understand the basics.

For **sending invoices**, create a workflow with these essential steps:

1. **Sign Envelope** - Signs the GOBL document. This can be substituted with `Add Sequential Code` with the `Sign Document` option enabled.
2. **Generate FatturaPA** - Converts the GOBL document to FatturaPA XML format and attaches it to the original invoice entry.
3. **Send to SDI (Italy)** - Takes the generated XML attachment and sends it to SDI. If `sandbox` is chosen as the environment, the simulated response from SDI must be set.

<Info>
The legacy **Send to SDI (Italy) (Legacy)** step that combines both generation and sending is still available, but its use is discouraged. It is marked with a legacy tag.
</Info>

<Info>
SDI does not have a sandbox environment. When `sandbox` mode is selected, Invopop's third-party submission service, [A-Cube](https://www.acubeapi.com), simulates a response from SDI.
</Info>

For **receiving invoices**, two workflows must be set up:

1. **Customer Registration** workflow with:
   - **Register SDI Customer (Italy)** - Registers a company's tax ID to receive invoices through SDI.

2. **Import Invoices** workflow with:
   - **Import from SDI (Italy)** - Converts received FatturaPA documents into GOBL format.

</Step>

<Step title="Configure app for import">

To enable automatic processing of received invoices:

1. Navigate to **Configuration** > **Apps**.
2. Find the **SDI Italy** app and click **Configure**.
3. In the sidebar that opens, select the appropriate **Import Invoices** workflow.
4. This workflow will automatically trigger whenever a new invoice is received through SDI.

Any errors in the import process will trigger the rescue steps in the workflow, allowing identification and resolution of issues.

</Step>

<Step title="Register to receive invoices">

To receive invoices, register the Recipient Code (Codice Destinatario) with the Italian tax authority:

1. Access the Italian tax authority's website (https://ivaservizi.agenziaentrate.gov.it/portale/) and log in with valid credentials.
2. Click on the "Fatture e Corrispettivi" section.
3. In the box "Fatturazione elettronica," click on "Registrazione delle modalità di ricezione della fattura elettronica."
4. Select the Recipient Code (Codice Destinatario) option and enter the code `JKKZDGR` provided by Invopop.
5. Click on "Conferma."

After completing this registration, execute the Customer Registration workflow to complete the setup.

<Info>
Registration is only required for receiving invoices, not for sending them. Each company that needs to receive invoices must be registered separately.
</Info>
</Step>
</Steps>

<AccordionGroup>
<Accordion title="Example Sending Invoice Workflow">
This JSON can be copied and pasted while editing a Workflow in "developer" mode. The example adds support for setting states on silo entries and handling errors, both of which are strongly recommended.

```json
{
    "name": "Invoice - Send with States",
    "description": "Generate and issue an invoice through SDI and set the state to `sent` if successful",
    "steps": [
        {
            "id": "1a692ae0-cd12-11ef-998c-e97f18c9212e",
            "name": "Set State",
            "provider": "silo.state",
            "summary": "Set state to `processing`{.state .processing}",
            "config": {
                "state": "processing"
            }
        },
        {
            "id": "1855b430-cd12-11ef-998c-e97f18c9212e",
            "name": "Sign Envelope",
            "provider": "silo.close"
        },
        {
            "id": "24f5c340-fd12-11ef-998c-e97f18c9212e",
            "name": "Generate FatturaPA",
            "provider": "sdi-it.generate",
            "summary": "Create XML document"
        },
        {
            "id": "2042f860-cd12-11ef-998c-e97f18c9212e",
            "name": "Send to SDI (Italy)",
            "provider": "sdi-it.send",
            "summary": "Sandbox · Accepted by PA (Notifica esito)",
            "config": {
                "environment": "sandbox",
                "response": "NE"
            }
        },
        {
            "id": "236965b0-cd12-11ef-998c-e97f18c9212e",
            "name": "Generate PDF",
            "provider": "pdf",
            "summary": "Italian",
            "config": {
                "date_format": "%Y-%m-%d",
                "locale": "it",
                "logo_height": 40
            }
        },
        {
            "id": "2b6db450-cd12-11ef-998c-e97f18c9212e",
            "name": "Set State",
            "provider": "silo.state",
            "summary": "Set state to `sent`{.state .sent}",
            "config": {
                "state": "sent"
            }
        }
    ],
    "rescue": [
        {
            "id": "2d5d7660-cd12-11ef-998c-e97f18c9212e",
            "name": "Set State",
            "provider": "silo.state",
            "summary": "Set state to `error`{.state .error}",
            "config": {
                "state": "error"
            }
        }
    ]
}
```
</Accordion>

<Accordion title="Example Customer Registration Workflow">
Use this workflow to register a company to receive invoices through SDI.

```json
{
    "name": "Register SDI Customer",
    "description": "Register a company to receive invoices through SDI",
    "steps": [
        {
            "id": "2a34f560-fd13-11ef-998c-e97f18c9212e",
            "name": "Set State",
            "provider": "silo.state",
            "summary": "Set state to `processing`{.state .processing}",
            "config": {
                "state": "processing"
            }
        },
        {
            "id": "3b5c7890-fd13-11ef-998c-e97f18c9212e",
            "name": "Register SDI Customer (Italy)",
            "provider": "sdi-it.register",
            "summary": "Register company as receiver",
            "config": {
                "environment": "production"
            }
        },
        {
            "id": "4c6d8910-fd13-11ef-998c-e97f18c9212e",
            "name": "Set State",
            "provider": "silo.state",
            "summary": "Set state to `registered`{.state .registered}",
            "config": {
                "state": "registered"
            }
        }
    ],
    "rescue": [
        {
            "id": "5d7e9a20-fd13-11ef-998c-e97f18c9212e",
            "name": "Set State",
            "provider": "silo.state",
            "summary": "Set state to `error`{.state .error}",
            "config": {
                "state": "error"
            }
        }
    ]
}
```
</Accordion>

<Accordion title="Example Import Invoices Workflow">
Use this workflow to import and process invoices received through SDI. This workflow must be selected in the SDI Italy app configuration to automatically process incoming invoices.

```json
{
    "name": "Import SDI Invoices",
    "description": "Import and process invoices received through SDI",
    "steps": [
        {
            "id": "6e8f0b30-fd13-11ef-998c-e97f18c9212e",
            "name": "Import from SDI (Italy)",
            "provider": "sdi-it.import",
            "summary": "Convert received FatturaPA to GOBL",
            "config": {
                "environment": "production"
            }
        },
        {
            "id": "7f9a1c40-fd13-11ef-998c-e97f18c9212e",
            "name": "Generate PDF",
            "provider": "pdf",
            "summary": "Italian",
            "config": {
                "date_format": "%Y-%m-%d",
                "locale": "it",
                "logo_height": 40
            }
        },
        {
            "id": "8a0b2d50-fd13-11ef-998c-e97f18c9212e",
            "name": "Set State",
            "provider": "silo.state",
            "summary": "Set state to `received`{.state .received}",
            "config": {
                "state": "received"
            }
        }
    ],
    "rescue": [
        {
            "id": "9b1c3e60-fd13-11ef-998c-e97f18c9212e",
            "name": "Set State",
            "provider": "silo.state",
            "summary": "Set state to `error`{.state .error}",
            "config": {
                "state": "error"
            }
        }
    ]
}
```
</Accordion>
</AccordionGroup>

## Running

Invopop uses the [GOBL FatturaPA](https://github.com/invopop/gobl.fatturapa) library to process conversions. Example invoices are provided below, along with sample workflows. We also recommend using the [GOBL Builder](https://build.gobl.org) to create custom invoices.

Be sure to set the `regime` field to `IT` in invoices and add the `it-sdi-v1` addon. This will add essential validations and normalizations to ensure document compliance and automatically add the necessary extensions, which can be found [here](https://github.com/invopop/gobl/tree/main/regimes/it#italy-specific-requirements).

### Sending Invoices

The two-step process for sending invoices works as follows:

1. **Generate FatturaPA** - This step converts a GOBL invoice into the required FatturaPA XML format and stores it as an attachment to the silo entry.

2. **Send to SDI** - This step takes the generated XML attachment and sends it to SDI through our integration partner. The SDI service usually responds within seconds but may take up to 24 hours. While waiting, this step remains in a `Queued` state.

<Info>
A legacy combined step that performs both generation and sending in one operation is also available. While still functional, we recommend using the separate steps for better control and error handling.
</Info>

When finished, the Send step returns:

- `OK` if successful
- `KO` for unrecoverable errors
- `SKIP` if the invoice was already sent

This step also returns a code that provides more information about the response from SDI. The codes include:

| Code | Description |
|------|-------------|
| `rejected` | **Notifica di scarto (NS)** - SDI has rejected the invoice because it contains errors. |
| `delivered` | **Ricevuta consegna (RC)** - SDI has successfully delivered a B2B invoice to the recipient. |
| `delivered-pa` | **Ricevuta consegna (RC)** - SDI has successfully delivered an invoice to a Public Administration (PA). |
| `not-delivered` | **Mancata consegna (MC)** - SDI could not deliver the invoice to the recipient. |
| `not-delivered` | **Attestazione trasmissione con impossibilità di recapito (AT)** - SDI couldn't deliver an invoice to PA after 10 days. |
| `accepted-pa` | **Notifica esito (NE)** - A PA has decided to accept an invoice (outcome EC01). |
| `rejected-pa` | **Notifica esito (NE)** - A PA has decided to reject an invoice (outcome EC02). |
| `deadline-terms` | **Notifica decorrenza termini (DT)** - A PA didn't reply with acceptance or rejection within 15 days. |
| `invoice-error` | An error occurred during the acquisition of a notification. |
| `sent` | The invoice has been submitted to SDI and is awaiting a response. |
| `not-received` | The invoice was not received by the recipient. |

Some SDI notifications (File metadati - MT, Esito committente - EC, Scarto esito committente - SE) don't directly change the code of the invoice.

When the SDI step processes these codes, they map to different step results as follows:

- **OK Result**: The following codes indicate successful processing and return an `OK` status:
  - `delivered` - Invoice successfully delivered to B2B recipient
  - `not-delivered` - Invoice couldn't be delivered, but the process completed
  - `not-received` - Invoice wasn't received, but the process completed
  - `accepted-pa` - Invoice accepted by Public Administration

- **KO Result**: The following codes indicate errors and return a `KO` status:
  - `rejected` - Invoice rejected due to errors
  - `rejected-pa` - Invoice rejected by Public Administration
  - `invoice-error` - Error during notification processing
  - `deadline-terms` - PA didn't respond within deadline

- **QUEUED Result**: The following codes indicate the process is still ongoing and return a `QUEUED` status:
  - `sent` - Invoice submitted to SDI, awaiting response
  - `delivered-pa` - Invoice delivered to PA, awaiting acceptance/rejection

When a step returns `QUEUED`, the workflow will check again later for updates from SDI.

### Receiving Invoices

To receive invoices through SDI, complete these three important steps:

1. **Register with Italian tax authority** - Register the Recipient Code `JKKZDGR` with the Italian tax authority as outlined in the setup steps.

2. **Set up the Customer Registration workflow** - Run this workflow for each company that needs to receive invoices. This registers the company's tax ID with our SDI integration partner to subscribe to invoice events for that organization.

3. **Configure the app for import** - Select the Import Invoices workflow in the SDI Italy app configuration to automatically process incoming invoices.

Once registered, any invoices addressed to the registered companies with the Recipient Code will be automatically received and processed through the Import Invoices workflow configured in the app settings.

The import process uses the open-source library gobl.fatturapa to convert FatturaPA documents into GOBL format, making them accessible within the Invopop workspace like any other document.

If errors occur during the import process, they will trigger the rescue steps in the workflow, allowing users to check what went wrong and take appropriate action.

## Example Invoices

<AccordionGroup>
<Accordion title="B2C Standard Invoice">
```json
{
  "$schema": "https://gobl.org/draft-0/bill/invoice",
  "$regime": "IT",
  "$addons": [
    "it-sdi-v1"
  ],
  "uuid": "0190a63a-1a80-7e1e-a868-08c7859b6470",
  "type": "standard",
  "series": "FT",
  "code": "020",
  "issue_date": "2024-07-12",
  "currency": "EUR",
  "tax": {
    "prices_include": "VAT",
    "ext": {
      "it-sdi-document-type": "TD01",
      "it-sdi-format": "FPR12"
    }
  },
  "supplier": {
    "name": "Company Name S.r.l.",
    "tax_id": {
      "country": "IT",
      "code": "12345678903"
    },
    "addresses": [
      {
        "num": "102",
        "street": "Via California",
        "locality": "Palermo",
        "region": "PA",
        "code": "33213",
        "country": "IT"
      }
    ],
    "registration": {
      "capital": "50000.00",
      "currency": "EUR",
      "office": "RM",
      "entry": "123456"
    },
    "ext": {
      "it-sdi-fiscal-regime": "RF01"
    }
  },
  "lines": [
    {
      "i": 1,
      "quantity": "1",
      "item": {
        "name": "Cleaning services",
        "price": "125.00"
      },
      "sum": "125.00",
      "taxes": [
        {
          "cat": "VAT",
          "rate": "standard",
          "percent": "22.0%"
        }
      ],
      "total": "125.00"
    }
  ],
  "totals": {
    "sum": "125.00",
    "tax_included": "22.54",
    "total": "102.46",
    "taxes": {
      "categories": [
        {
          "code": "VAT",
          "rates": [
            {
              "key": "standard",
              "base": "102.46",
              "percent": "22.0%",
              "amount": "22.54"
            }
          ],
          "amount": "22.54"
        }
      ],
      "sum": "22.54"
    },
    "tax": "22.54",
    "total_with_tax": "125.00",
    "payable": "125.00"
  }
}
```
</Accordion>
<Accordion title="B2B Invoice">
```json
{
    "$schema": "https://gobl.org/draft-0/bill/invoice",
    "$regime": "IT",
    "$addons": [
        "it-sdi-v1"
    ],
    "$tags": [
        "freelance"
    ],
    "uuid": "0190c0ec-8109-756b-a4f0-88c4b542ab6e",
    "type": "standard",
    "series": "SAMPLE",
    "code": "001",
    "issue_date": "2023-03-02",
    "currency": "EUR",
    "tax": {
        "ext": {
            "it-sdi-document-type": "TD06",
            "it-sdi-format": "FPR12"
        }
    },
    "supplier": {
        "name": "MªF. Services",
        "tax_id": {
            "country": "IT",
            "code": "12345678903"
        },
        "people": [
            {
                "name": {
                    "given": "GIANCARLO",
                    "surname": "ROSSI"
                }
            }
        ],
        "addresses": [
            {
                "num": "1",
                "street": "VIALE DELLA LIBERTÀ",
                "locality": "ROMA",
                "region": "RM",
                "code": "00100",
                "country": "IT"
            }
        ],
        "ext": {
            "it-sdi-fiscal-regime": "RF01"
        }
    },
    "customer": {
        "name": "MARIO LEONI",
        "tax_id": {
            "country": "IT",
            "code": "09876543217"
        },
        "addresses": [
            {
                "num": "32",
                "street": "VIALE DELI LAVORATORI",
                "locality": "FIRENZE",
                "region": "FI",
                "code": "50100",
                "country": "IT"
            }
        ]
    },
    "lines": [
        {
            "i": 1,
            "quantity": "20",
            "item": {
                "name": "Development services",
                "price": "90.00",
                "unit": "h"
            },
            "sum": "1800.00",
            "taxes": [
                {
                    "cat": "VAT",
                    "rate": "standard",
                    "percent": "22.0%"
                }
            ],
            "total": "1800.00"
        }
    ],
    "totals": {
        "sum": "1800.00",
        "total": "1800.00",
        "taxes": {
            "categories": [
                {
                    "code": "VAT",
                    "rates": [
                        {
                            "key": "standard",
                            "base": "1800.00",
                            "percent": "22.0%",
                            "amount": "396.00"
                        }
                    ],
                    "amount": "396.00"
                }
            ],
            "sum": "396.00"
        },
        "tax": "396.00",
        "total_with_tax": "2196.00",
        "payable": "2196.00"
    }
}
```
</Accordion>
</AccordionGroup>

## FAQ

<AccordionGroup>
<Accordion title="Is electronic invoicing mandatory in Italy?">

Yes, electronic invoicing through SDI is mandatory in Italy for B2G, B2B, and B2C transactions.

All invoices must be issued in FatturaPA format and transmitted through the SDI (Sistema di Interscambio) platform.

</Accordion>
<Accordion title="How can I correct an invoice?">

There are two main ways to correct an invoice in the Italian SDI system:

1. Issue a credit note (Nota di Credito - TD04) to fully or partially cancel the original invoice.
2. Issue a debit note (Nota di Debito - TD05) to integrate/correct the original invoice with additional charges.

The corrective document must reference the original invoice number and date.

</Accordion>
<Accordion title="Why is my invoice processing taking so long?">

The SDI system can take up to 24 hours to process invoices, especially during peak periods. While waiting, the "Send to SDI" step will remain in the `QUEUED` state. The system will automatically check for updates, and the status will change once SDI has processed the invoice.

</Accordion>
<Accordion title="How do I know if my invoice was delivered successfully?">

Once the SDI process is complete, the workflow will show one of several status codes:
- `delivered` - The invoice was successfully delivered to a B2B recipient
- `accepted-pa` - The invoice was accepted by a Public Administration
- `not-delivered` - The invoice couldn't be delivered, but was processed correctly by SDI

Check the workflow history to see the exact status.

</Accordion>
<Accordion title="Can I use the same workflow for both sending and receiving invoices?">

No, sending and receiving invoices require different workflows:
- For sending invoices, a workflow with the Generate FatturaPA and Send to SDI steps is needed
- For receiving invoices, two workflows are required: 
  1. A Customer Registration workflow (run once for each company that needs to receive invoices)
  2. An Import Invoices workflow (configured to run automatically)

</Accordion>
<Accordion title="Can I register multiple companies to receive invoices?">

Yes, multiple companies can be registered to receive invoices through a single Invopop workspace. Each company must:
1. Register the Recipient Code `JKKZDGR` with the Italian tax authority
2. Have its tax ID registered using the Customer Registration workflow
3. Use the same Import Invoices workflow configured in the app settings

This is particularly useful for white-labeling scenarios where a user manages multiple entities.

</Accordion>
</AccordionGroup>
