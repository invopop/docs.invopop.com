---
title: "SaaS Platforms"
description: Integrate Invopop in your SaaS Platform
---
## Introduction
Many of our customers are global software platforms that provide an invoicing module and integrate Invopop to comply with local e-invoicing requirements. This includes Point-of-Sale (POS), Enterprise Resource Planning (ERP), or vertical SaaS platforms, such as software for managing hotels, gyms, beauty centers, or any type of business. This guide focuses on these cases, as they involve an extra layer of complexity compared to companies that use Invopop to issue their own invoices.

For illustration, we'll use a fictitious company called **Hotelpop**, a SaaS that helps hotels manage things like guest check-ins, room cleaning, maintenance, and checkout.

Hotelpop features an invoicing interface that allows front desk staff to enter customer details, add charges, and generate PDF invoices. As Hotelpop expands into new markets, hotels must adhere to local e-invoicing regulations, requiring it to convert invoices into specific XML formats and report them to tax authorities. To fulfill these requirements, Hotelpop integrates Invopop.

## Prerequisites

This guide assumes you have a solid understanding of Invopop basics, including GOBL, workflow operations, and invoicing implementation in at least one country. You should have followed a country-specific guide (or the PDF one) and tested uploading an invoice to Invopop and sending it to a workflow.

If you're ready to design how your system integrates with Invopop, particularly the user experience, this guide is for you.

## Main flow: Issuing invoices

We'll examine the process from the perspective of a Hotelpop user, a receptionist.

### Step 1: Creating a Silo Entry

The process begins when a receptionist fills out an invoice form in Hotelpop. At this stage, the invoice remains in "draft" status within Hotelpop, allowing the user to edit or save it without fiscal impact.

When the user is ready to issue the invoice, they click a confirmation button like **"Send Invoice."** Hotelpop converts the invoice into a GOBL and uploads it to Invopop using the [**Create an Entry**](https://docs.invopop.com/api-ref/silo/entries/create-an-entry-put) endpoint. This endpoint requires a unique identifier code (UUID) generated by Hotelpop to identify each invoice. Make sure to store this ID, as you will need it later.

The **Create Entry** endpoint performs three functions:

1. **Validation:** Invopop verifies invoice fields, ensuring correct formatting and required fields. For example, it checks whether a Tax ID has the correct number of digits (e.g., 11 in Italy) or whether a mandatory Municipality Code is present (as required in Colombia).
2. **Calculation:** Invopop calculates tax totals, discounts, and invoice totals. If your system has already calculated these, Invopop overwrites them to align with tax authority requirements, preventing failures due to rounding differences. More on this in section "Ensuring Calculation Consistency" below.
3. **Storage in the Silo:** If validation and calculation succeed, the invoice is stored in Invopop, and the API call will return **200 status**. Invopop's storage is called the Silo, and each document, such as an invoice, is called a **Silo Entry.** If there's any error in the validation and calculation step, Invopop will not store the invoice and return a **4xx status** and an error message.

<Accordion title="422 returned by the API when uploading an invoice with an incorrect Tax ID code">
    ```json
    {
       "key": "validation",
       "message": "validation",
       "fields": {
           "data": {
               "doc": {
                   "customer": {
                       "tax_id": {
                           "code": "unknown type"
                       }
                   }
               }
           }
       }
    }
    ```
</Accordion>

### Step 2: Handling the Response and Creating a Job

The **Create an Entry** endpoint is synchronous, typically responding in milliseconds. Consequently, when the receptionist presses **Send Invoice,** Hotelpop can wait for Invopop's feedback, for example, with a spinner on the button or a "pressed" animation on the button.

#### Successful Upload

If the entry is successfully stored, you can immediately send it to a workflow by calling the [**Create a Job**](https://docs.invopop.com/api-ref/transform/jobs/create-a-job-put) endpoint. Each instance of a document running through a workflow is called a **job**, hence the endpoint name "Create a Job." The job processes tasks such as converting the invoice to the required format, submitting it to the tax authority, and triggering webhooks.

This endpoint performs minimal validation and primarily forwards the invoice to the workflow, typically responding immediately.

Once the job is successfully published, Hotelpop will display a confirmation message to the user (e.g., a toast notification) indicating the invoice was sent for e-invoicing. You may also update the invoice status to **processing**, signaling that it is being handled but not yet accepted by the tax authority.

Most tax authorities reply in seconds, but delays can occur due to connectivity issues. Some authorities, such as those in Italy, can take up to two days to respond. If you plan to scale globally, we recommend considering potential delay in your user experience design.

#### Invoice Not Uploaded

If **Create an Entry** returns an error, Hotelpop will parse the error (e.g., Tax ID of customer is incorrect) and show it to the receptionist. The invoice will stay in "draft" status in Hotelpop, so the receptionist can correct the error and click on **"Send Invoice"** again, going back to Step 1. 

### Step 3: Receiving Webhook Notifications

Once the job is running, Hotelpop needs a way to receive feedback from it. If successful, it may want to fetch the XML and PDF invoices for user display and update the invoice status. On the other hand, if errors occur, Hotelpop wants to notify users to correct the invoice or create a new one.

While you could poll regularly for the job until it's finished, our recommended approach is to include webhooks in the workflow, listen to them, and use them as triggers to fetch the **Silo Entry** (step 4).

<Accordion title="Example of workflow with error-handling and webhooks">
In this workflow, Hotelpop will receive a webhook when the job finishes, and the state of the Silo Entry will be **Sent** if there were no errors along the job and **Error** if there were any KOs.

After creating a job, Hotelpop can wait for the webhook and then use the Silo Entry ID included in the webhook to fetch the state from the corresponding Silo entry (Step 4). This is our recommended approach.

<Frame>
  <img
    alt="Workflow with error handling and webhooks"
    src="/guides/images/saas-guide-workflow-error-handling.png"
    width="350px"
  />
</Frame>
</Accordion>

### Step 4: Fetching the Silo Entry

Once you receive the webhook from the job, you may fetch the [**Silo Entry**](https://docs.invopop.com/api-ref/silo/entries/fetch-an-entry) and use it to update the invoice status on your system, notify users of errors, and manage output invoices.

The **Silo Entry** contains:

- **State:** Indicates whether the workflow completed successfully.
- **Faults Array:** Lists errors encountered, helping users correct the invoice.
- **Attachments:** Includes generated files such as PDF and XML invoices.

## Other Considerations

### Handling Post-Submission Errors

In Step 1, we discussed that most invoice errors are caught by GOBL validations and returned to you synchronously when uploading the invoice. At Invopop, we put a lot of effort into including as many validations in GOBL as possible to catch errors early.

However, some validations can only be performed by the tax authority, such as whether a business with a seemingly valid tax ID is actually registered in the country. As a result, some invoices may fail during processing. So, how can the user correct these cases?

If an invoice fails within a job, users can correct it in two ways:

1. **Correct the same Silo Entry:** Allow users to edit the invoice in your UI, PATCH the original Silo Entry, and resend it to the workflow.
2. **Void and reissue:** Void the original invoice by creating a credit note and generating a new, corrected Silo Entry.

While option 1 is simpler, some jurisdictions, especially those with fiscalization requirements (e.g., TicketBAI, VeriFactu, Portugal), do not allow invoice modifications past a certain stage. We will provide more details soon.

### Ensuring Calculation Consistency

As discussed in Step 1, Invopop recalculates invoice fields to ensure compliance with tax authorities. However, you're likely calculating invoice subtotal, totals, and discounts on your system, so how do you avoid the edge case of not matching our validation?

To avoid discrepancies, we recommend to align your calculations with Invopop's method using one of the following approaches:

1. **Match your algorithm with GOBL's open-source calculation function.**
2. **Use the Build GOBL Document endpoint** to send a partial GOBL and receive a fully calculated and validated GOBL.
3. **Implement the GOBL library within your system** for direct alignment.

## FAQs

<AccordionGroup>
<Accordion title="Can I fetch the Job instead of the Silo Entry?">
  You may be tempted to check the invoice status by **fetching the Job** instead of the **Silo Entry**. While possible, fetching the Silo Entry simplifies error handling, especially if you need to retry issuing an invoice by sending the Silo Entry to a workflow.
</Accordion>
</AccordionGroup>